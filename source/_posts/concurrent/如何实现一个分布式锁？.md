---
title: 如何实现一个分布式锁？
date: 2023-09-05 19:08:50
tags: [Redis]
categories: [并发]
---

## 一、什么是分布式锁？
分布式锁，是一种跨进程、跨机器节点的互斥锁，它可以用来保证多机器节点对于共享资源访问的互斥性。

## 二、分布式锁的特点
想要实现一个分布式锁，主要要有以下几个特点：
* **互斥性**：同一时间只能有一个线程获取到锁，然后去访问共享资源
* **可重入性**：允许一个已经获取到锁的线程，在没有释放锁之前再次重新获得锁
* **避免死锁**：由于分布式网络下容易出现网络延迟、节点故障等原因，死锁概率会比较高，所以需要设置一定的超时机制，让分布式锁在一定时间后自动过期删除
* ...

## 三、如何实现一个分布式锁？
想要实现一个分布式锁，就需要依赖一个第三方的分布式组件，比如数据库、Redis等，同时考虑锁的性能问题，所以我们一般使用Redis来实现分布式锁。

### 1、Redis实现分布式锁
在Redis中，可以通过`setnx`命令实现锁的互斥性，当key不存在就返回1，存在就返回0。另外还可以通过`expire`命令设置锁的失效时间，从而避免死锁问题。

## 四、Q&A
### 1、如果锁过期了，而业务逻辑没处理完怎么办？
可以定时给锁进行续期（比如锁五分钟过期，那么可以每分钟为他续期到五分钟过期），常见的方式有通过Redisson组件来实现一个分布式锁，并且也内置了一个Watch Dog机制来对锁做续期

### 2、Redis的分布式锁只有setnx这一方式吗？
为了保证分布式的可靠性，尽可能减少重复加锁的问题，Redis的分布式锁的演变阶段会由setnx->Redission->RedLock