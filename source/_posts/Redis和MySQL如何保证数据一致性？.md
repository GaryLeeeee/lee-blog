---
title: Redis和MySQL如何保证数据一致性？
date: 2023-07-23 23:28:07
tags: 并发
categories: 并发
---

## 一、背景
一般情况下，Redis是用来实现应用和数据库之间读操作的缓存层，主要目的是<font color=red>减少数据库IO</font>，还可以用来<font color=red>提升数据的IO性能</font>

## 二、设计思想
当应用需要读取某个数据的时候，会有几个步骤：
* 尝试去Redis查询，如果命中就直接返回
* 如果没有命中，则从数据库查询
* 同步数据库数据到Redis

## 三、可能出现问题&方案
当数据发生变化的时候，需要同时更新Redis和MySQL，**原先方案**有：
**先更新数据库，再更新缓存**：
* **问题1**：如果更新数据库成功，还没来得及更新缓存，这时候有另外一个客户端去访问了缓存，访问到了是旧的数据，这时候就会出现<font color=red>数据不一致</font>
* **问题2**：如果缓存更新失败，也会导致<font color=red>数据不一致</font>

**先删除缓存，再更新数据库**：
* **预期**：应用下次请求数据，发现缓存没数据，则从数据库同步数据到缓存里
* **分析**：极端情况下，由于删除缓存和更新数据库的这两个操作不是原子的，所以还是会出现<font color=red>数据不一致</font>
* **问题**：如果删除了缓存，还没来得及更新数据库，这时候有另外一个客户端去访问了缓存，发现没数据，所以去数据库同步了旧的数据，这时候数据库才更新了新的数据，就会出现<font color=red>数据不一致</font>



    
