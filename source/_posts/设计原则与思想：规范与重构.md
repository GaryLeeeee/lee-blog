---
title: 设计原则与思想：规范与重构
date: 2021-12-03 22:24:16
tags: [设计模式]
categories: [设计模式,设计模式之美,设计原则,规则与重构]
---

# 设计原则与思想：规则与重构
## 理论一：重构的why、what、when、how
### 重构的目的：为什么重构（why）？
* 对于项目而言，重构可以保持代码质量持续处于一个可控状态，不至于太糟糕(无可救药)
* 对于个人而言，重构非常锻炼一个人的代码能力(很有成就感)

### 重构的对象：重构什么（what）？
* 大规模高层次的重构
    * 代码分层
    * 模块化
    * 解耦
    * 梳理类之间的交互关系
    * 抽象复用组件
    * ...

* 小规模低层次的重构
    * 规范命名
    * 注释
    * 修正函数参数过多
    * 消除超大类
    * 提取重复代码
    * ...
    
### 重构的时机：什么时候重构（when）？
* 建立持续`重构`意识
* `重构`要融入日常开发中
* 而非等到代码出现大问题才`重构`

### 重构的方法：如何重构（how）？
* 大规模高层次的重构
    * 有组织、有计划地进行
    * 分阶段地小步快跑
    * 时刻让代码处于一个可运行的状态
* 小规模低层次的重构
    * 随时随地
  
## 理论二：单元测试(保证重构不出错的技术手段)
* **What**：
  * 代码层面的测试，用来测试编写代码逻辑的正确性
  * **单元**一般是类或函数，而不是模块或者系统
* **Why**：
  * 写`单元测试`的过程本身就是代码Code Review和重构的过程，能有效发现代码中的BUG和代码设计上的问题
  * `单元测试`是`集成测试`的有力补充
  * 能帮助我们快速熟悉代码
* **How**：
  * 针对代码设计各种测试用例，以覆盖各种输入、异常、边界情况，并翻译成代码
  * `单元测试`不要依赖被测代码的具体实现逻辑
  * 难以编写`单元测试`，往往是代码的可测试性不好(说明要重构了)
* **Example**：
```java
@RunWith(SpringRunner.class)
@SppringBootTest
public class UserTest {
  @Autowired
  private UserService userService;

  @Test
  public void getUser(){
    //测试getUserById接口是否正常
    User user = userService.getUserById(111L);
    //user不为空断言(如果为空会报错)
    Assert.assertNotNull(user);
  }
}
```