---
title: 如何设计一个高并发系统？
date: 2023-07-19 14:35:54
tags: 并发
categories: 并发
---


## 笔记
* 高性能：比如一个接口1s能处理1个请求，那么10s就能处理10个请求（如果用户请求排在了第10位，那么需要等10s后才能处理），所以提高接口的性能，使接口1s能处理10个请求，就叫高并发了
* 高扩展
* 高可用

## 高性能
* 数据库调优
* JVM调优
* 缓存：redis、本地缓存
* 异步：消息队列
* 池化技术：
    * 线程池（存Thread对象）
    * 连接池（存Connection对象）
    * 内存池（JVM堆）等
* 增加硬件资源：
    * CPU、CPU核
    * 内存
    * 磁盘
    * 带宽
    

## 数据库调优
**索引**：
* 索引最左匹配原则：如索引bcd的话查询b=xxx也是命中的
* 覆盖索引：尽量不要使用select *，减少回表
* 分页limit：如limit 100,1000，尽量走索引如id，不然越后面效率越慢
* order by，group by：尽量走索引
* join小表驱动大表

**buffer pool**：
* page：数据、索引

**锁**：
**事务**：尽早提交，才能释放锁，尽量使用小事务
**读写分离**：主从集群
**分库分表**：
* 分库：按照场景、功能等将表放在不同的库，减少单库的数据量，同时也能防止单表异常导致影响其他表
* 分表：防止单表过大，按照id、uid（可用雪花算法做分布式ID）等进行hash分表（如product表分为product_1、product_2、...、product_9）

## JVM调优
* 升级JDK
* 监控
* 工具：
* 项目：日志等排查出可能出现的问题
* 学习JVM底层原理：GC等

## 缓存
* redis
* 本地缓存：性能更高，缺点是多台机可能数据不一致
* 多级缓存：redis+本地缓存，也就是默认读本地缓存，不存在的则从redis读取并写入到本地缓存，如果redis没有的话则从mysql读取，可以加过期时间保证最终一致

## 异步消息
* 优点：解耦、方便重试

## 池化技术
* 连接池：Connection对象
* 线程池：Thread对象
* 内存池：JVM堆

## 高扩展
重点：负载均衡
横向扩展：Tomcat、Nginx、LVS

步骤：
* 智能DNS，能够根据客户端ip地址就近选择LVS
* LVS再对请求进行负载均衡分散到各个nginx中
* nginx再做一级负载均衡请求分散到各个Tomcat中