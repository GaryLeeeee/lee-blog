---
title: 如何设计一个秒杀系统？
date: 2023-07-17 20:59:19
tags: 场景题
categories: 场景题
---

## 一、分析秒杀系统
### 1、秒杀系统的特点
* 瞬间流量大
* 秒杀商品库存少
* 秒杀前刷新频繁

### 2、秒杀系统需要考虑的点
**秒杀前**：
* 页面资源访问多：资源静态化，存CDN就近访问，开启资源压缩，减少传输数据量，提高速度
* 秒杀按钮置灰：前端可通过秒杀按钮置灰来拦截部分流量到后端，如秒杀前置灰，请求未返回置灰
* 秒杀真链接隐藏：秒杀开始后才暴露秒杀真链接，防止刷子提前获取链接做脚本刷新

**秒杀中**：
* 高并发/快响应：上线前要做好压测，评估服务器qps瓶颈点
* 防止超卖：大量用户抢少量商品，需要防止高并发（可以用redis的lua脚本保证原子性操作）
* 限流：限制用户请求频率，如一个人1s内只能请求10次，一个ip最多请求10次等

**秒杀后**：
* 异步处理订单后续：秒杀成功后，同步返回秒杀结果，并异步处理订单后续（如生成订单、通知等）
* 服务降级（系统）：如用户秒杀成功但没正常生成订单，需要用MQ处理并重试，并且需要做好监控告警
* 服务降级（人工）：如商品错误设置了价格（如iphone设置了1元一台），为了及时止损，需要加一个降级开关，返回秒杀已结束等文案
